<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>form tester</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <form
      id="uniForm"
      class="form-container"
      action="https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse"
      method="POST"
      target="_blank"
    >
      <div class="card header-card">
        <h1 class="form-title">테스트 폼</h1>
        <p class="form-description">폼 설명을 입력하세요</p>
      </div>

      <!-- 섹션 1: Email -->
      <div class="card">
        <label for="email" class="field-label"
          >Email <span class="required-marker">*</span></label
        >
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder="답변을 입력하세요"
          class="form-input"
        />
      </div>

      <!-- 섹션 2: Order number -->
      <div class="card">
        <label for="orderNumber" class="field-label"
          >Order number <span class="required-marker">*</span></label
        >
        <input
          type="text"
          id="orderNumber"
          name="orderNumber"
          required
          placeholder="답변을 입력하세요"
          class="form-input"
        />
      </div>

      <!-- 섹션 3: Return pick-up address -->
      <div class="card">
        <label for="returnAddress" class="field-label"
          >Return pick-up address (please include pin code)
          <span class="required-marker">*</span></label
        >
        <textarea
          id="returnAddress"
          name="returnAddress"
          rows="4"
          required
          placeholder="답변을 입력하세요"
          class="form-textarea"
        ></textarea>
      </div>

      <!-- 섹션 4: Return item quantity -->
      <div class="card">
        <label for="returnQuantity" class="field-label"
          >Return item quantity <span class="required-marker">*</span></label
        >
        <input
          type="number"
          id="returnQuantity"
          name="returnQuantity"
          required
          placeholder="답변을 입력하세요"
          class="form-input"
        />
      </div>

      <!-- 섹션 5: Mobile phone number -->
      <div class="card">
        <label for="mobilePhone" class="field-label"
          >Mobile phone number (10 Digits)
          <span class="required-marker">*</span></label
        >
        <input
          type="tel"
          id="mobilePhone"
          name="mobilePhone"
          required
          pattern="[0-9]{10}"
          maxlength="10"
          placeholder="10자리 숫자를 입력하세요"
          class="form-input"
        />
      </div>

      <!-- 섹션 6: Return reason (라디오 버튼) -->
      <div class="card">
        <label class="field-label"
          >Return reason <span class="required-marker">*</span></label
        >
        <div class="radio-group">
          <label class="radio-label">
            <input
              type="radio"
              name="returnReason"
              value="defective"
              required
              class="radio-input"
            />
            <span>Defective item</span>
          </label>
          <label class="radio-label">
            <input
              type="radio"
              name="returnReason"
              value="wrong"
              required
              class="radio-input"
            />
            <span>Wrong item received</span>
          </label>
          <label class="radio-label">
            <input
              type="radio"
              name="returnReason"
              value="size"
              required
              class="radio-input"
            />
            <span>Wrong size</span>
          </label>
          <label class="radio-label">
            <input
              type="radio"
              name="returnReason"
              value="other"
              required
              class="radio-input"
              id="returnReasonOther"
            />
            <span class="other-label-text"
              >Other:
              <input
                type="text"
                id="otherReasonText"
                name="otherReasonText"
                placeholder=""
                class="other-text-input"
              />
            </span>
          </label>
        </div>
      </div>

      <!-- 섹션 7: Check for return condition (체크박스) -->
      <div class="card">
        <label class="field-label"
          >Check for return condition
          <span class="required-marker">*</span></label
        >
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              name="returnCondition"
              value="unused"
              required
              class="checkbox-input"
            />
            <span>Item is unused</span>
          </label>
          <label class="checkbox-label">
            <input
              type="checkbox"
              name="returnCondition"
              value="originalPackage"
              required
              class="checkbox-input"
            />
            <span>Original package included</span>
          </label>
          <label class="checkbox-label">
            <input
              type="checkbox"
              name="returnCondition"
              value="tags"
              required
              class="checkbox-input"
            />
            <span>Tags attached</span>
          </label>
        </div>
      </div>

      <!-- 안보이는 honeypot 필드 (봇 방지용) -->
      <input
        type="text"
        id="website"
        name="website"
        tabindex="-1"
        autocomplete="off"
        class="honeypot-field"
      />

      <!-- 제출 버튼 섹션 -->
      <div class="submit-section">
        <button type="submit" id="submitBtn" class="submit-btn">제출</button>
        <button type="button" id="clearBtn" class="clear-btn">Clear</button>
      </div>
    </form>
  </body>
  <script>
    // Honeypot 필드 감지 및 제출 버튼 비활성화
    const honeypotField = document.getElementById('website');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const form = document.getElementById('uniForm');

    honeypotField.addEventListener('input', function () {
      if (this.value.trim() !== '') {
        // honeypot 필드에 값이 입력되면 제출 버튼 비활성화
        submitBtn.disabled = true;
      } else {
        // 값이 비어있으면 제출 버튼 활성화
        submitBtn.disabled = false;
      }
    });

    // Other 라디오 버튼 선택 시 텍스트 입력 필드 필수 여부 설정
    const otherReasonText = document.getElementById('otherReasonText');
    const returnReasonRadios = form.querySelectorAll(
      'input[name="returnReason"]'
    );

    // Other 텍스트 입력 시 validation 메시지 초기화
    otherReasonText.addEventListener('input', function () {
      if (this.value.trim() !== '') {
        this.setCustomValidity(''); // 텍스트가 입력되면 validation 메시지 제거
      }
    });

    returnReasonRadios.forEach((radio) => {
      radio.addEventListener('change', function () {
        // 라디오 버튼 변경 시 항상 validation 메시지 초기화
        // required 속성을 잠시 제거하여 validation 상태 완전히 리셋
        const wasRequired = otherReasonText.required;
        otherReasonText.required = false;
        otherReasonText.setCustomValidity('');

        // 값을 임시로 변경하여 validation 상태 리셋
        const currentValue = otherReasonText.value;
        otherReasonText.value = '';
        otherReasonText.value = currentValue;

        if (this.value === 'other') {
          otherReasonText.required = true;
        } else {
          otherReasonText.required = false;
          otherReasonText.value = '';
        }
      });
    });

    // Clear 버튼 클릭 시 폼 전체 초기화
    clearBtn.addEventListener('click', function () {
      form.reset();
      // 라디오 버튼과 체크박스도 명시적으로 초기화
      const radioButtons = form.querySelectorAll('input[type="radio"]');
      radioButtons.forEach((radio) => {
        radio.checked = false;
      });
      const checkboxes = form.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach((checkbox) => {
        checkbox.checked = false;
      });
      // Other 텍스트 입력 필드 초기화
      otherReasonText.required = false;
      otherReasonText.setCustomValidity(''); // validation 메시지 초기화
    });

    // 폼 제출 처리
    document.getElementById('uniForm').addEventListener('submit', function (e) {
      // honeypot 필드에 값이 있으면 제출 방지
      if (honeypotField.value.trim() !== '') {
        e.preventDefault();
        alert('Spam detected. Submission is not allowed.');
        return false;
      }

      // FormData 생성
      const formData = new FormData(this);
      const data = Object.fromEntries(formData);

      // Other 옵션이 선택되었는데 텍스트가 비어있으면 제출 방지
      // Google Form entry ID 형식 사용 (예: entry.123456789)
      // TODO: returnReason의 실제 entry ID로 변경하세요
      const returnReasonEntryId = 'entry.XXXXX'; // 실제 entry ID로 변경 필요
      if (data[returnReasonEntryId] === 'other') {
        if (!otherReasonText.value || otherReasonText.value.trim() === '') {
          e.preventDefault();
          otherReasonText.setCustomValidity(
            'Please specify the reason in the Other field.'
          );
          otherReasonText.reportValidity();
          return false;
        } else {
          otherReasonText.setCustomValidity(''); // 유효성 통과 시 메시지 제거
        }
      } else {
        // Other 옵션이 선택되지 않았으면 otherReasonText 제외
        otherReasonText.setCustomValidity(''); // 메시지 초기화
      }

      // 제출 버튼 비활성화 (중복 제출 방지)
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      // Google Form으로 직접 제출 (기본 form 동작 허용)
      // form의 action과 method로 자동 제출됨
    });
  </script>
</html>
